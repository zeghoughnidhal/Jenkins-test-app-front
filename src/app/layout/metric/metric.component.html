<div [@routerTransition]>

  <div class="card mb-3">
    <div class="row">
      <div class="col col-xl-12 col-lg-12">
        <button class="btn btn-info" [routerLink]="['/metrics']" [routerLinkActive]="['router-link-active']">
          <i class="fa fa-fw fa-folder"></i>
          root
        </button>
        <button class="btn btn-info" *ngIf="pathLevel1"
                [routerLink]="['/metrics', pathLevel1]"
                [routerLinkActive]="['router-link-active']">
          <i class="fa fa-fw fa-folder"></i>
          {{ pathLevel1 }}
        </button>
        <button class="btn btn-info" *ngIf="pathLevel2"
                [routerLink]="['/metrics', pathLevel1, pathLevel2]"
                [routerLinkActive]="['router-link-active']">
          <i class="fa fa-fw fa-folder"></i>
          {{ pathLevel2 }}
        </button>
        <button class="btn btn-info" *ngIf="pathLevel3"
                [routerLink]="['/metrics', pathLevel1, pathLevel2, pathLevel3]"
                [routerLinkActive]="['router-link-active']">
          <i class="fa fa-fw fa-folder"></i>
          {{ pathLevel3 }}
        </button>
      </div>
    </div>
  </div>

  <div class="row" *ngIf="subFolders.length">
    <div class="col col-xl-12 col-lg-12">
      <div class="breadcrumb">

        <span *ngIf="!pathLevel1 && !pathLevel2 && !pathLevel3">
          <button class="btn btn-info" *ngFor="let sub_folder of subFolders"
                  [routerLink]="['/metrics', sub_folder]"
                  [routerLinkActive]="['router-link-active']">
            <i class="fa fa-fw fa-folder"></i>
            {{ sub_folder }}
          </button>
        </span>

        <span *ngIf="pathLevel1 && !pathLevel2 && !pathLevel3">
          <button class="btn btn-info" *ngFor="let sub_folder of subFolders"
                  [routerLink]="['/metrics', pathLevel1, sub_folder]"
                  [routerLinkActive]="['router-link-active']">
            <i class="fa fa-fw fa-folder"></i>
            {{ sub_folder }}
          </button>
        </span>

        <span *ngIf="pathLevel2 && !pathLevel3">
          <button class="btn btn-info" *ngFor="let sub_folder of subFolders"
                  [routerLink]="['/metrics', pathLevel1, pathLevel2, sub_folder]"
                  [routerLinkActive]="['router-link-active']">
            <i class="fa fa-fw fa-folder"></i>
            {{ sub_folder }}
          </button>
        </span>

        <span *ngIf="pathLevel3">
          <button class="btn btn-info" *ngFor="let sub_folder of subFolders"
                  [routerLink]="['/metrics', pathLevel1, pathLevel2, pathLevel3, sub_folder]"
                  [routerLinkActive]="['router-link-active']">
            <i class="fa fa-fw fa-folder"></i>
            {{ sub_folder }}
          </button>
        </span>
      </div>

    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="row">

        <div class="col-md-1">
          <i class="fa fa-fw fa-folder"></i>
        </div>

        <div class="col-md-5">
          <input type="text" class="form-control" id="name" [(ngModel)]="pathFull.text" name="name">
        </div>

        <div class="col-md-2">
          <button type="button" class="btn btn-primary" (click)="refreshFolder(pathFull.text)">Refresh</button>
        </div>

<!--        <div class="row col-md-4">-->
<!--          <label class="checkbox-inline">-->
<!--            <input type="checkbox" [(ngModel)]="displayJobLink"> Show Job Link-->
<!--          </label>-->
<!--        </div>-->

      </div>
    </div>
    <div class="panel-body">
    <!-- Table -->
      <table class="table table-striped">

        <!-- envs in header -->
        <thead>
        <tr>
        <th>Job Name</th>
        <th *ngFor="let env of envs">{{env}}</th>
        </tr>
        </thead>

        <!-- jobs results in table body -->
        <tbody>
              <tr *ngFor="let keyViewName of jobs | keyvalue">
                <!--job name (keyViewName.key)-->
                <td> {{ keyViewName.key }}</td>
                <!--job results for this keyViewName (for each env)-->
                <td *ngFor="let env2 of envs">
                  <div *ngIf="jobs[keyViewName.key][env2]; let job">
                    <span (click)="selectJobInfo(job)">
                      <i [ngStyle]="{'color': job.color === 'blue' ? 'green' :
                                                  job.color === 'red' ? 'red' :
                                                  'grey'}"
                         class="fa fa-fw fa-star">
                        </i>
                    </span>
<!--                    <span *ngIf="displayJobLink">-->
<!--                      <a href="{{ job.url }}"><i class="fa fa-fw fa-eye"></i></a>-->
<!--                    </span>-->
                  </div>
                </td>
              </tr>
        </tbody>

      </table>

    </div>
  </div>


  <div *ngIf="selectedJob">
    <div class="card">
      <div class="card-header">
        {{ selectedJob.name }}
      </div>
      <div class="card-body">
        Folder Name : {{ selectedJob.folderName }} <br>
        Jenkins URL : <a href="{{ selectedJob.url }}"> {{ selectedJob.url }} </a> <br>
        Latest build Date : {{ selectedJob.lastBuild.timestamp | date }} <br>
        Latest build Duration : {{ selectedJob.lastBuild.duration | date: 'HH:mm:ss': 'UTC' }} <br>
        Latest 3 builds : <br>

<!--        <ngb-accordion #acc="ngbAccordion" activeIds="">-->

          <div *ngFor="let build of getLastThreeBuilds(selectedJob)">

            <button type="button" class="btn btn-primary" (click)="getBuildErrorTests(selectedJob.fullName, build.id)">Refresh</button>
              <div *ngIf="buildErrors[selectedJob.fullName] && buildErrors[selectedJob.fullName][build.id]">
                <div *ngFor="let testError of buildErrors[selectedJob.fullName][build.id]">
                  {{ testError.className }}
                </div>
              </div>

<!--            <ngb-panel title="{{ build.id }}">-->
<!--              <ng-template ngbPanelContent>-->
<!--              {{ build.result }}-->

<!--                <div *ngIf="getBuildErrorTests(selectedJob.fullName, build.id) | async; let buildErrors">-->
<!--                  <div *ngFor="let error of buildErrors">-->
<!--                      {{ error.className }}-->
<!--                  </div>-->
<!--                </div>-->

<!--              </ng-template>-->
<!--            </ngb-panel>-->

          </div>

<!--        </ngb-accordion>-->
      </div>
  </div>
  </div>

</div>
